FROM openjdk:21-ea-21-jdk-slim
LABEL authors="macky"
LABEL description="Smart Gateway Java Plugin Runner for Apache APISIX"

# 设置工作目录
WORKDIR /app

# 复制 JAR 包和启动脚本
COPY target/smart-gateway-1.0.jar /app/app.jar
COPY start.sh /app/start.sh

# 设置脚本执行权限
RUN chmod +x /app/start.sh

# 创建 /tmp 目录并设置权限
RUN mkdir -p /tmp && chmod 777 /tmp

# 暴露调试端口（可选）
EXPOSE 5005

# 使用启动脚本
CMD ["/app/start.sh"]